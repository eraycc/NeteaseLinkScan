<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç½‘æ˜“äº‘éŸ³ä¹çŸ­é“¾æ£€æŸ¥å·¥å…·</title>
    <link href="https://cdn.jsdmirror.cn/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdmirror.cn/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --vip-color: #28a745;
            --gift-color: #ffc107;
            --info-color: #17a2b8;
            --error-color: #dc3545;
            /* ä¼˜åŒ–åçš„æ—¥å¿—é¢œè‰² */
            --log-success-color: #155724;
            --log-success-bg: #d4edda;
            --log-warning-color: #856404;
            --log-warning-bg: #fff3cd;
            --log-danger-color: #721c24;
            --log-danger-bg: #f8d7da;
            --log-info-color: #0c5460;
            --log-info-bg: #d1ecf1;
        }
        
        body {
            background-color: #f8f9fa;
            padding-bottom: 20px;
        }
        
        .result-card {
            margin-bottom: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
            border-left: 4px solid;
        }
        
        .result-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .vip-card {
            border-left-color: var(--vip-color);
        }
        
        .gift-card {
            border-left-color: var(--gift-color);
        }
        
        .config-card {
            background-color: #f8f9fa;
        }
        
        /* ä¼˜åŒ–åçš„æ—¥å¿—æ ·å¼ */
        .log-entry {
            font-family: 'SF Mono', 'Monaco', 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            font-size: 0.875rem;
            padding: 10px 16px;
            margin: 2px 0;
            border-radius: 6px;
            border-left: 4px solid transparent;
            line-height: 1.4;
            word-break: break-word;
            white-space: normal;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .log-entry:hover {
            transform: translateX(2px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        /* æ‰¹æ¬¡æ—¥å¿—ç‰¹æ®Šæ ·å¼ */
        .log-batch {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border-left-color: #2196f3;
            color: #1565c0;
            font-weight: 500;
        }
        
        /* ä¼˜åŒ–åçš„æ—¥å¿—é¢œè‰²æ–¹æ¡ˆ */
        .log-success {
            color: var(--log-success-color);
            background-color: var(--log-success-bg);
            border-left-color: #28a745;
        }
        
        .log-warning {
            color: var(--log-warning-color);
            background-color: var(--log-warning-bg);
            border-left-color: #ffc107;
        }
        
        .log-danger {
            color: var(--log-danger-color);
            background-color: var(--log-danger-bg);
            border-left-color: #dc3545;
        }
        
        .log-info {
            color: var(--log-info-color);
            background-color: var(--log-info-bg);
            border-left-color: #17a2b8;
        }
        
        .hidden {
            display: none;
        }
        
        #progressBar {
            transition: width 0.3s ease;
        }
        
        .url-container {
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            word-break: break-all;
        }
        
        .url-line {
            display: inline-block;
            max-width: 100%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .expandable {
            cursor: pointer;
        }
        
        .expanded {
            white-space: normal;
            word-break: break-all;
        }
        
        .card-body-scroll {
            max-height: 300px;
            overflow-y: auto;
            padding: 0 !important;
        }
        
        .result-item {
            padding: 10px 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        /* ä¼˜åŒ–æ—¥å¿—å¡ç‰‡æ ·å¼ */
        .log-card {
            border-radius: 8px;
            border-left: 4px solid #6c757d;
        }
        
        .log-card .card-body {
            padding: 0;
        }
        
        .log-card .card-header {
            background: linear-gradient(135deg, #6c757d 0%, #545b62 100%);
            border-bottom: 1px solid rgba(0, 0, 0, 0.125);
        }
        
        /* æ—¥å¿—è¾“å‡ºå®¹å™¨ä¼˜åŒ– */
        #logOutput {
            padding: 8px;
            background-color: #f8f9fa;
            border-radius: 4px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        /* æ—¥å¿—ä¸ºç©ºæ—¶çš„æç¤º */
        .log-empty {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            padding: 20px;
        }
        
        /* æ‰¹æ¬¡ç»Ÿè®¡æ ·å¼ */
        .batch-stats {
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8ff 100%);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #28a745;
        }
        
        .batch-stats h6 {
            color: #155724;
            margin-bottom: 10px;
        }
        
        .batch-stats .row {
            text-align: center;
        }
        
        .batch-stats .badge {
            font-size: 0.9rem;
            padding: 8px 12px;
        }
        
        /* æ‰¹æ¬¡è®¡ç®—å™¨æ ·å¼ */
        .batch-calculator {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 10px;
            margin-top: 10px;
            font-size: 0.85rem;
        }
        
        .batch-calculator .text-warning {
            color: #856404 !important;
        }
        
        /* é«˜çº§é…ç½®æŠ˜å æ ·å¼ */
        .advanced-config {
            border-top: 1px solid #dee2e6;
            margin-top: 15px;
            padding-top: 15px;
        }
        
        .advanced-toggle {
            cursor: pointer;
            color: #6c757d;
            text-decoration: none;
            font-size: 0.9rem;
        }
        
        .advanced-toggle:hover {
            color: #495057;
            text-decoration: underline;
        }
        
        .advanced-toggle i {
            transition: transform 0.2s ease;
        }
        
        .advanced-toggle.collapsed i {
            transform: rotate(-90deg);
        }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            .card-body-scroll {
                max-height: 200px;
            }
            
            .log-entry {
                padding: 8px 12px;
                font-size: 0.8rem;
            }
            
            .container {
                padding-left: 10px;
                padding-right: 10px;
            }
            
            #logOutput {
                max-height: 250px;
                padding: 6px;
            }
        }
        
        @media (min-width: 992px) {
            .card-body-scroll {
                max-height: 400px;
            }
            
            #logOutput {
                max-height: 450px;
            }
        }
        
        /* ä¼˜åŒ–è¿›åº¦æ¡åœ¨ç§»åŠ¨ç«¯çš„æ˜¾ç¤º */
        .progress {
            height: 25px;
        }
        
        /* ä¼˜åŒ–çŠ¶æ€æ¶ˆæ¯æ˜¾ç¤º */
        #statusMessage {
            margin-bottom: 15px;
        }
        
        /* ä¼˜åŒ–æ»šåŠ¨æ¡æ ·å¼ */
        .card-body-scroll::-webkit-scrollbar,
        #logOutput::-webkit-scrollbar {
            width: 6px;
        }
        
        .card-body-scroll::-webkit-scrollbar-track,
        #logOutput::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        
        .card-body-scroll::-webkit-scrollbar-thumb,
        #logOutput::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }
        
        .card-body-scroll::-webkit-scrollbar-thumb:hover,
        #logOutput::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        /* æ—¥å¿—æ—¶é—´æˆ³æ ·å¼ä¼˜åŒ– */
        .log-timestamp {
            font-weight: 600;
            opacity: 0.8;
        }
        
        .log-code {
            font-weight: 500;
            font-family: 'SF Mono', 'Monaco', monospace;
        }
        
        .log-message {
            font-weight: 500;
        }
        
        /* æ‰¹æ¬¡è¯¦æƒ…æ ·å¼ */
        .batch-details {
            margin-top: 5px;
            font-size: 0.85rem;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="container py-4">
        <h1 class="text-center mb-4"><i class="bi bi-link-45deg"></i>ç½‘æ˜“äº‘éŸ³ä¹çŸ­é“¾æ£€æŸ¥å·¥å…·</h1>
        
        <div class="row">
            <div class="col-md-4">
                <div class="card config-card mb-4">
                    <div class="card-header bg-primary text-white">
                        <i class="bi bi-gear"></i> é…ç½®é€‰é¡¹
                    </div>
                    <div class="card-body">
                        <form id="configForm">
                            <div class="mb-3">
                                <label for="startSuffix" class="form-label">èµ·å§‹çŸ­é“¾åç¼€</label>
                                <input type="text" class="form-control" id="startSuffix" value="Bm5xqZ" required>
                                <div class="form-text">è¯·è¾“å…¥å6ä½Base62ç¼–ç çš„çŸ­é“¾åç¼€ï¼Œå¦‚ï¼šhttp://163cn.tv/FBm5xqZï¼Œåªå¡«å†™Bm5xqZ</div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="prefix" class="form-label">çŸ­é“¾å‰ç¼€</label>
                                <input type="text" class="form-control" id="prefix" value="F" required>
                                <div class="form-text">çŸ­é“¾çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œå¦‚ï¼šF</div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="maxRange" class="form-label">æœ€å¤§éå†èŒƒå›´</label>
                                <input type="number" class="form-control" id="maxRange" value="900000000" required>
                                <div class="form-text">ä»èµ·å§‹IDå¼€å§‹æ£€æŸ¥çš„æ•°é‡</div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="batchSize" class="form-label">æ¯æ‰¹å¤„ç†æ•°é‡</label>
                                <input type="number" class="form-control" id="batchSize" value="50" min="1" max="100" required>
                                <div class="form-text">æ¯æ¬¡å¹¶å‘è¯·æ±‚çš„é“¾æ¥æ•°é‡ï¼Œå»ºè®®10-100</div>
                            </div>
                            
                            <!-- æ–°å¢ï¼šè‡ªå®šä¹‰èµ·å§‹æ‰¹æ¬¡ -->
                            <div class="mb-3">
                                <label for="startBatch" class="form-label">
                                    è‡ªå®šä¹‰èµ·å§‹æ‰¹æ¬¡
                                    <i class="bi bi-info-circle" data-bs-toggle="tooltip" 
                                       title="è®¾ç½®ä»ç¬¬å‡ æ‰¹å¼€å§‹æ£€æµ‹ï¼Œé»˜è®¤ä»ç¬¬1æ‰¹å¼€å§‹ã€‚ç”¨äºè·³è¿‡å·²æ£€æµ‹çš„æ‰¹æ¬¡ã€‚"></i>
                                </label>
                                <input type="number" class="form-control" id="startBatch" min="1" placeholder="ç•™ç©ºåˆ™ä»ç¬¬1æ‰¹å¼€å§‹">
                                <div class="form-text">ç•™ç©ºæˆ–è¾“å…¥1è¡¨ç¤ºä»ç¬¬1æ‰¹å¼€å§‹ï¼Œå¤§äº1åˆ™è·³è¿‡å‰é¢çš„æ‰¹æ¬¡</div>
                                
                                <!-- æ‰¹æ¬¡è®¡ç®—æ˜¾ç¤º -->
                                <div id="batchCalculator" class="batch-calculator hidden">
                                    <div class="text-warning">
                                        <i class="bi bi-calculator"></i> æ‰¹æ¬¡è®¡ç®—ï¼š
                                    </div>
                                    <div id="batchInfo"></div>
                                </div>
                            </div>
                            
                            <!-- é«˜çº§é…ç½®æŠ˜å åŒºåŸŸ -->
                            <div class="advanced-config">
                                <a class="advanced-toggle collapsed" data-bs-toggle="collapse" href="#advancedConfig">
                                    <i class="bi bi-chevron-down"></i> é«˜çº§é…ç½®
                                </a>
                                
                                <div class="collapse" id="advancedConfig">
                                    <div class="mt-3">
                                        <div class="mb-3">
                                            <label for="base62Chars" class="form-label">Base62å­—ç¬¦é›†</label>
                                            <input type="text" class="form-control" id="base62Chars" 
                                                   value="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789" required>
                                            <div class="form-text">è‡ªå®šä¹‰Base62ç¼–ç å­—ç¬¦é¡ºåº</div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label for="sleepTime" class="form-label">æ£€æŸ¥é—´éš”(ç§’)</label>
                                            <input type="number" class="form-control" id="sleepTime" value="0.5" min="0.1" step="0.1" required>
                                            <div class="form-text">æ‰¹æ¬¡ä¹‹é—´çš„é—´éš”æ—¶é—´</div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label for="timeout" class="form-label">è¯·æ±‚è¶…æ—¶(ç§’)</label>
                                            <input type="number" class="form-control" id="timeout" value="5" min="1" required>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="d-grid gap-2 mt-4">
                                <button type="submit" class="btn btn-primary" id="submitBtn">
                                    <span id="loadingSpinner" class="spinner-border spinner-border-sm d-none"></span>
                                    <span id="submitText">å¼€å§‹æ£€æŸ¥</span>
                                </button>
                                <button type="button" class="btn btn-outline-secondary" id="pauseBtn">æš‚åœ</button>
                            </div>
                            <div class="d-grid gap-2 mt-3">
                                <button type="button" class="btn btn-outline-danger hidden" id="deleteResultsBtn">
                                    <i class="bi bi-trash"></i> åˆ é™¤å½“å‰æ£€æµ‹ä¿¡æ¯
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <div class="col-md-8">
                <div class="card mb-4">
                    <div class="card-header bg-info text-white">
                        <i class="bi bi-speedometer2"></i> è¿›åº¦ç›‘æ§
                    </div>
                    <div class="card-body">
                        <div class="progress mb-3">
                            <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated" 
                                 role="progressbar" style="width: 0%"></div>
                        </div>
                        <div id="statusMessage" class="alert mb-3"></div>
                        
                        <!-- æ‰¹æ¬¡ç»Ÿè®¡ä¿¡æ¯ -->
                        <div id="batchStats" class="batch-stats hidden">
                            <h6><i class="bi bi-graph-up"></i> æ‰¹æ¬¡ç»Ÿè®¡</h6>
                            <div class="row">
                                <div class="col-md-3 mb-2">
                                    <span class="badge bg-primary">æ‰¹æ¬¡ <span id="currentBatch">0</span>/<span id="totalBatches">0</span></span>
                                </div>
                                <div class="col-md-3 mb-2">
                                    <span class="badge bg-success">å½“å‰æ‰¹æ¬¡ <span id="currentBatchSize">0</span></span>
                                </div>
                                <div class="col-md-3 mb-2">
                                    <span class="badge bg-info">å¹³å‡é€Ÿåº¦ <span id="avgSpeed">0</span>/åˆ†é’Ÿ</span>
                                </div>
                                <div class="col-md-3 mb-2">
                                    <span class="badge bg-secondary">å·²ç”¨æ—¶é—´ <span id="elapsedTime">0ç§’</span></span>
                                </div>
                            </div>
                            <div class="row mt-2">
                                <div class="col-md-6 mb-2">
                                    <span class="badge bg-warning text-dark">è·³è¿‡æ‰¹æ¬¡ <span id="skippedBatches">0</span></span>
                                </div>
                                <div class="col-md-6 mb-2">
                                    <span class="badge bg-dark">æ€»è¿›åº¦ <span id="overallProgress">0</span>%</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-2 mb-md-0">
                                <div class="card bg-light">
                                    <div class="card-body text-center">
                                        <h6 class="card-title">å·²æ£€æŸ¥</h6>
                                        <h4 id="checkedCount" class="card-text">0</h4>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card bg-light">
                                    <div class="card-body text-center">
                                        <h6 class="card-title">å½“å‰æ£€æŸ¥</h6>
                                        <h4 id="currentCode" class="card-text">-</h4>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3 mb-md-0">
                        <div class="card h-100">
                            <div class="card-header bg-success text-white">
                                <i class="bi bi-check-circle"></i> VIPé“¾æ¥ (<span id="vipCount">0</span>)
                            </div>
                            <div class="card-body-scroll" id="vipResults"></div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-header bg-warning text-dark">
                                <i class="bi bi-gift"></i> ç¤¼ç‰©é“¾æ¥ (<span id="giftCount">0</span>)
                            </div>
                            <div class="card-body-scroll" id="giftResults"></div>
                        </div>
                    </div>
                </div>
                
                <div class="card mt-4 log-card">
                    <div class="card-header text-white">
                        <i class="bi bi-list-check"></i> æ£€æŸ¥æ—¥å¿—
                    </div>
                    <div class="card-body">
                        <div id="logOutput">
                            <div class="log-empty">æš‚æ— æ—¥å¿—è®°å½•</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdmirror.cn/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let pollingInterval;
        let isProcessing = false;
        let currentConfig = {};
        let startTime = null;
        
        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('configForm').addEventListener('submit', function(e) {
                e.preventDefault();
                startProcessing();
            });
            
            document.getElementById('pauseBtn').addEventListener('click', toggleProcessing);
            document.getElementById('deleteResultsBtn').addEventListener('click', deleteResults);
            
            // ç›‘å¬æ‰¹æ¬¡ç›¸å…³è¾“å…¥å˜åŒ–ï¼Œæ›´æ–°è®¡ç®—å™¨
            document.getElementById('maxRange').addEventListener('input', updateBatchCalculator);
            document.getElementById('batchSize').addEventListener('input', updateBatchCalculator);
            document.getElementById('startBatch').addEventListener('input', updateBatchCalculator);
            
            // åˆå§‹åŒ–tooltip
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl)
            });
            
            // åŠ è½½ä¿å­˜çš„é…ç½®ï¼ˆå¦‚æœæœ‰ï¼‰
            loadSavedConfig();
            updateBatchCalculator();
        });
        
        function updateBatchCalculator() {
            const maxRange = parseInt(document.getElementById('maxRange').value) || 0;
            const batchSize = parseInt(document.getElementById('batchSize').value) || 1;
            const startBatch = parseInt(document.getElementById('startBatch').value) || 1;
            
            if (maxRange > 0 && batchSize > 0) {
                const totalBatches = Math.ceil(maxRange / batchSize);
                const startId = (startBatch - 1) * batchSize;
                const skippedCount = startId;
                const remainingCount = maxRange - skippedCount;
                const remainingBatches = Math.ceil(remainingCount / batchSize);
                
                const calculator = document.getElementById('batchCalculator');
                const batchInfo = document.getElementById('batchInfo');
                
                if (startBatch > 1) {
                    calculator.classList.remove('hidden');
                    batchInfo.innerHTML = `
                        <div><strong>æ€»æ‰¹æ¬¡æ•°ï¼š</strong>${totalBatches.toLocaleString()}</div>
                        <div><strong>èµ·å§‹æ‰¹æ¬¡ï¼š</strong>ç¬¬ ${startBatch.toLocaleString()} æ‰¹</div>
                        <div><strong>è·³è¿‡æ•°é‡ï¼š</strong>${skippedCount.toLocaleString()} ä¸ªID</div>
                        <div><strong>å‰©ä½™æ£€æµ‹ï¼š</strong>${remainingCount.toLocaleString()} ä¸ªID</div>
                        <div><strong>å‰©ä½™æ‰¹æ¬¡ï¼š</strong>${remainingBatches.toLocaleString()} æ‰¹</div>
                    `;
                    
                    // éªŒè¯èµ·å§‹æ‰¹æ¬¡æ˜¯å¦æœ‰æ•ˆ
                    if (startBatch > totalBatches) {
                        batchInfo.innerHTML += `<div class="text-danger mt-2"><i class="bi bi-exclamation-triangle"></i> è­¦å‘Šï¼šèµ·å§‹æ‰¹æ¬¡è¶…è¿‡æ€»æ‰¹æ¬¡æ•°ï¼</div>`;
                    }
                } else {
                    calculator.classList.add('hidden');
                }
            }
        }
        
        function startProcessing() {
            const startSuffix = document.getElementById('startSuffix').value.trim();
            const maxRange = document.getElementById('maxRange').value;
            const batchSize = document.getElementById('batchSize').value;
            const startBatch = document.getElementById('startBatch').value;
            const prefix = document.getElementById('prefix').value.trim();
            const base62Chars = document.getElementById('base62Chars').value.trim();
            const sleepTime = document.getElementById('sleepTime').value;
            const timeout = document.getElementById('timeout').value;
            
            if (!validateInputs(startSuffix, maxRange, prefix, base62Chars, batchSize, startBatch)) {
                return;
            }
            
            currentConfig = {
                start_suffix: startSuffix,
                max_range: parseInt(maxRange),
                start_batch: parseInt(startBatch) || 1,
                config: {
                    prefix: prefix,
                    base62_chars: base62Chars,
                    BASE: base62Chars.length,
                    sleep_time: parseFloat(sleepTime),
                    timeout: parseInt(timeout),
                    batch_size: parseInt(batchSize)
                }
            };
            
            // è®°å½•å¼€å§‹æ—¶é—´
            if (!startTime) {
                startTime = Date.now();
            }
            
            // ä¿å­˜é…ç½®åˆ°æœ¬åœ°å­˜å‚¨
            saveConfig();
            
            // æ›´æ–°UIçŠ¶æ€
            updateUIState(true);
            
            // å¼€å§‹å¤„ç†
            processNextBatch();
        }
        
        function validateInputs(startSuffix, maxRange, prefix, base62Chars, batchSize, startBatch) {
            if (!startSuffix || !maxRange || !prefix || !base62Chars || !batchSize) {
                showAlert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ', 'danger');
                return false;
            }
            
            if (startSuffix.length !== 6) {
                showAlert('çŸ­é“¾åç¼€å¿…é¡»æ˜¯6ä½å­—ç¬¦', 'danger');
                return false;
            }
            
            if (prefix.length !== 1) {
                showAlert('çŸ­é“¾å‰ç¼€å¿…é¡»æ˜¯1ä½å­—ç¬¦', 'danger');
                return false;
            }
            
            const batchSizeNum = parseInt(batchSize);
            if (batchSizeNum < 1 || batchSizeNum > 100) {
                showAlert('æ¯æ‰¹å¤„ç†æ•°é‡å¿…é¡»åœ¨1-100ä¹‹é—´', 'danger');
                return false;
            }
            
            const maxRangeNum = parseInt(maxRange);
            const startBatchNum = parseInt(startBatch) || 1;
            const totalBatches = Math.ceil(maxRangeNum / batchSizeNum);
            
            if (startBatchNum > totalBatches) {
                showAlert(`èµ·å§‹æ‰¹æ¬¡(${startBatchNum})ä¸èƒ½è¶…è¿‡æ€»æ‰¹æ¬¡æ•°(${totalBatches})`, 'danger');
                return false;
            }
            
            if (startBatchNum < 1) {
                showAlert('èµ·å§‹æ‰¹æ¬¡å¿…é¡»å¤§äºç­‰äº1', 'danger');
                return false;
            }
            
            return true;
        }
        
        function toggleProcessing() {
            if (isProcessing) {
                pauseProcessing();
                this.textContent = 'ç»§ç»­';
            } else {
                startProcessing();
                this.textContent = 'æš‚åœ';
            }
        }
        
        function pauseProcessing() {
            clearTimeout(pollingInterval);
            isProcessing = false;
            updateUIState(false);
            updateStatusMessage('å¤„ç†å·²æš‚åœ', 'warning');
        }
        
        function updateUIState(processing) {
            const submitBtn = document.getElementById('submitBtn');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const submitText = document.getElementById('submitText');
            
            if (processing) {
                document.getElementById('deleteResultsBtn').classList.remove('hidden');
                document.getElementById('batchStats').classList.remove('hidden');
                submitBtn.disabled = true;
                loadingSpinner.classList.remove('d-none');
                submitText.textContent = 'å¤„ç†ä¸­...';
                isProcessing = true;
            } else {
                submitBtn.disabled = false;
                loadingSpinner.classList.add('d-none');
                submitText.textContent = 'å¼€å§‹æ£€æŸ¥';
            }
        }
        
        function processNextBatch() {
            if (!isProcessing) return;
            
            fetch('api.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(currentConfig)
            })
            .then(handleResponse)
            .then(data => {
                updateUI(data);
                
                if (data.status === 'completed') {
                    processingComplete();
                } else if (isProcessing) {
                    pollingInterval = setTimeout(processNextBatch, currentConfig.config.sleep_time * 1000);
                }
            })
            .catch(handleError);
        }
        
        function handleResponse(response) {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        }
        
        function handleError(error) {
            console.error('Error:', error);
            showAlert(`è¯·æ±‚å¤±è´¥: ${error.message}`, 'danger');
            pauseProcessing();
        }
        
        function updateUI(data) {
            updateProgress(data);
            updateStatus(data);
            updateCounters(data);
            updateBatchStats(data);
            updateResults(data);
            updateLog(data);
        }
        
        function updateProgress(data) {
            const progress = data.progress ? Math.min(100, data.progress) : 0;
            document.getElementById('progressBar').style.width = `${progress}%`;
            document.getElementById('progressBar').textContent = `${progress.toFixed(1)}%`;
        }
        
        function updateStatus(data) {
            const statusClass = data.status === 'completed' ? 'success' : 'info';
            updateStatusMessage(data.message || 'å¤„ç†ä¸­...', statusClass);
        }
        
        function updateCounters(data) {
            document.getElementById('checkedCount').textContent = data.checked || 0;
            document.getElementById('currentCode').textContent = data.current_code || '-';
        }
        
        function updateBatchStats(data) {
            if (data.batch_stats) {
                const stats = data.batch_stats;
                const config = currentConfig.config;
                const startBatch = currentConfig.start_batch || 1;
                
                // è®¡ç®—å®é™…çš„æ‰¹æ¬¡å·ï¼ˆè€ƒè™‘èµ·å§‹æ‰¹æ¬¡ï¼‰
                const actualCurrentBatch = (startBatch - 1) + (stats.completed_batches || 0);
                const skippedBatches = startBatch - 1;
                
                document.getElementById('currentBatch').textContent = actualCurrentBatch;
                document.getElementById('totalBatches').textContent = stats.total_batches || 0;
                document.getElementById('currentBatchSize').textContent = stats.current_batch_size || 0;
                document.getElementById('skippedBatches').textContent = skippedBatches;
                
                // è®¡ç®—æ€»ä½“è¿›åº¦ï¼ˆåŒ…æ‹¬è·³è¿‡çš„éƒ¨åˆ†ï¼‰
                const totalRange = currentConfig.max_range;
                const processedCount = (data.checked || 0) + (skippedBatches * config.batch_size);
                const overallProgress = Math.min(100, (processedCount / totalRange) * 100);
                document.getElementById('overallProgress').textContent = overallProgress.toFixed(1);
                
                // è®¡ç®—å¹³å‡é€Ÿåº¦å’Œå·²ç”¨æ—¶é—´
                if (startTime) {
                    const elapsedSeconds = Math.floor((Date.now() - startTime) / 1000);
                    const elapsedMinutes = elapsedSeconds / 60;
                    document.getElementById('elapsedTime').textContent = formatTime(elapsedSeconds);
                    
                    if (elapsedMinutes > 0 && data.checked) {
                        const avgSpeed = Math.round(data.checked / elapsedMinutes);
                        document.getElementById('avgSpeed').textContent = avgSpeed;
                    }
                }
            }
        }
        
        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            
            if (hours > 0) {
                return `${hours}å°æ—¶${minutes}åˆ†${secs}ç§’`;
            } else if (minutes > 0) {
                return `${minutes}åˆ†${secs}ç§’`;
            } else {
                return `${secs}ç§’`;
            }
        }
        
        function updateResults(data) {
            if (data.vip_links) {
                updateResultSection('vip', Object.values(data.vip_links));
            }
            if (data.gift_links) {
                updateResultSection('gift', Object.values(data.gift_links));
            }
        }
        
        function updateResultSection(type, links) {
            const containerId = `${type}Results`;
            const countId = `${type}Count`;
            
            document.getElementById(countId).textContent = links.length;
            
            const resultsHTML = links.map(link => createResultCard(type, link)).join('');
            document.getElementById(containerId).innerHTML = resultsHTML;
            
            // æ·»åŠ ç‚¹å‡»äº‹ä»¶æ¥å±•å¼€/æŠ˜å é•¿URL
            document.querySelectorAll(`#${containerId} .expandable`).forEach(el => {
                el.addEventListener('click', function() {
                    this.classList.toggle('expanded');
                });
            });
        }
        
        function createResultCard(type, link) {
            const typeClass = type === 'vip' ? 'vip-card' : 'gift-card';
            const btnClass = type === 'vip' ? 'btn-success' : 'btn-warning';
            
            return `
                <div class="result-card ${typeClass}">
                    <div class="result-item">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1 me-2">
                                <h6 class="card-title mb-1 url-line">${link.url}</h6>
                                <p class="card-text text-muted small mb-0">
                                    <span class="expandable url-container" title="ç‚¹å‡»å±•å¼€/æŠ˜å ">
                                        è·³è½¬åˆ°: ${link.redirect}
                                    </span>
                                </p>
                            </div>
                            <a href="${link.url}" target="_blank" class="btn btn-sm ${btnClass}">
                                <i class="bi bi-box-arrow-up-right"></i>
                            </a>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function updateLog(data) {
            const logOutput = document.getElementById('logOutput');
            
            if (!data.log || data.log.length === 0) {
                logOutput.innerHTML = '<div class="log-empty">æš‚æ— æ—¥å¿—è®°å½•</div>';
                return;
            }
            
            logOutput.innerHTML = data.log.map(log => createLogEntry(log)).join('');
            logOutput.scrollTop = logOutput.scrollHeight;
        }
        
        function createLogEntry(log) {
            const logClass = getLogClass(log.result);
            const timestamp = sanitizeText(log.time);
            const code = sanitizeText(log.code);
            const resultText = getResultText(log.result);
            
            let entryHTML = `
                <div class="log-entry ${logClass}">
                    <span class="log-timestamp">[${timestamp}]</span>
                    <span class="log-code">${code}</span>
                    <span class="log-message"> - ${resultText}</span>
            `;
            
            // å¦‚æœæ˜¯æ‰¹æ¬¡æ—¥å¿—ï¼Œæ·»åŠ è¯¦ç»†ä¿¡æ¯
            if (log.result === 'batch_completed' && log.details) {
                const details = log.details;
                entryHTML += `
                    <div class="batch-details">
                        æ‰¹æ¬¡å¤§å°: ${details.batch_size} | 
                        VIP: ${details.vip_found} | 
                        ç¤¼ç‰©: ${details.gift_found} | 
                        å…¶ä»–: ${details.other_redirect} | 
                        æ— æ•ˆ: ${details.invalid} | 
                        é”™è¯¯: ${details.error}
                    </div>
                `;
            }
            
            entryHTML += '</div>';
            return entryHTML;
        }
        
        function sanitizeText(text) {
            if (!text) return '';
            return text.toString().trim().replace(/\s+/g, ' ');
        }
        
        function getLogClass(result) {
            const classMap = {
                'vip': 'log-success',
                'gift': 'log-success',
                'other_redirect': 'log-warning',
                'invalid': 'log-info',
                'error': 'log-danger',
                'batch_completed': 'log-batch',
                'config_updated': 'log-info',
                'batch_skipped': 'log-warning'
            };
            return classMap[result] || 'log-info';
        }
        
        function getResultText(result) {
            const resultTexts = {
                'vip': 'âœ… VIPé“¾æ¥',
                'gift': 'ğŸ ç¤¼ç‰©é“¾æ¥',
                'other_redirect': 'âš ï¸ å…¶ä»–è·³è½¬',
                'invalid': 'âŒ æ— æ•ˆé“¾æ¥',
                'error': 'âš ï¸ è¯·æ±‚é”™è¯¯',
                'batch_completed': 'ğŸ“¦ æ‰¹æ¬¡å®Œæˆ',
                'config_updated': 'âš™ï¸ é…ç½®æ›´æ–°',
                'batch_skipped': 'â­ï¸ æ‰¹æ¬¡è·³è¿‡'
            };
            return resultTexts[result] || result;
        }
        
        function updateStatusMessage(message, type = 'info') {
            const statusMessage = document.getElementById('statusMessage');
            statusMessage.innerHTML = `
                <div class="alert alert-${type} mb-0">
                    <strong>çŠ¶æ€ï¼š</strong> ${message}
                </div>
            `;
        }
        
        function showAlert(message, type = 'info') {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type} alert-dismissible fade show`;
            alert.role = 'alert';
            alert.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            `;
            
            document.querySelector('.container').prepend(alert);
            
            setTimeout(() => {
                const bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
            }, 5000);
        }
        
        function processingComplete() {
            clearTimeout(pollingInterval);
            isProcessing = false;
            updateUIState(false);
            document.getElementById('progressBar').classList.remove('progress-bar-animated');
            showAlert('å¤„ç†å®Œæˆï¼', 'success');
        }
        
        function deleteResults() {
            if (!confirm('ç¡®å®šè¦åˆ é™¤å½“å‰é…ç½®çš„æ£€æµ‹ä¿¡æ¯å—ï¼Ÿæ­¤æ“ä½œå°†åˆ é™¤ç¼“å­˜çš„æ—¥å¿—æ–‡ä»¶ä¸”ä¸å¯æ¢å¤ï¼')) {
                return;
            }
            
            fetch('api.php?action=delete', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(currentConfig)
            })
            .then(handleResponse)
            .then(data => {
                if (data.success) {
                    showAlert('å·²æˆåŠŸåˆ é™¤å½“å‰æ£€æµ‹ä¿¡æ¯', 'success');
                    resetUI();
                } else {
                    showAlert('åˆ é™¤å¤±è´¥: ' + data.message, 'danger');
                }
            })
            .catch(handleError);
        }
        
        function resetUI() {
            document.getElementById('vipResults').innerHTML = '';
            document.getElementById('giftResults').innerHTML = '';
            document.getElementById('vipCount').textContent = '0';
            document.getElementById('giftCount').textContent = '0';
            document.getElementById('logOutput').innerHTML = '<div class="log-empty">æš‚æ— æ—¥å¿—è®°å½•</div>';
            document.getElementById('progressBar').style.width = '0%';
            document.getElementById('checkedCount').textContent = '0';
            document.getElementById('currentCode').textContent = '-';
            document.getElementById('batchStats').classList.add('hidden');
            document.getElementById('batchCalculator').classList.add('hidden');
            updateStatusMessage('æ£€æµ‹ä¿¡æ¯å·²é‡ç½®', 'info');
            document.getElementById('deleteResultsBtn').classList.add('hidden');
            startTime = null;
        }
        
        function saveConfig() {
            const config = {
                startSuffix: document.getElementById('startSuffix').value,
                maxRange: document.getElementById('maxRange').value,
                batchSize: document.getElementById('batchSize').value,
                startBatch: document.getElementById('startBatch').value,
                prefix: document.getElementById('prefix').value,
                base62Chars: document.getElementById('base62Chars').value,
                sleepTime: document.getElementById('sleepTime').value,
                timeout: document.getElementById('timeout').value
            };
            localStorage.setItem('shortLinkCheckerConfig', JSON.stringify(config));
        }
        
        function loadSavedConfig() {
            const savedConfig = localStorage.getItem('shortLinkCheckerConfig');
            if (savedConfig) {
                try {
                    const config = JSON.parse(savedConfig);
                    document.getElementById('startSuffix').value = config.startSuffix;
                    document.getElementById('maxRange').value = config.maxRange;
                    if (config.batchSize) document.getElementById('batchSize').value = config.batchSize;
                    if (config.startBatch) document.getElementById('startBatch').value = config.startBatch;
                    document.getElementById('prefix').value = config.prefix;
                    document.getElementById('base62Chars').value = config.base62Chars;
                    document.getElementById('sleepTime').value = config.sleepTime;
                    document.getElementById('timeout').value = config.timeout;
                } catch (e) {
                    console.error('åŠ è½½ä¿å­˜çš„é…ç½®å¤±è´¥:', e);
                }
            }
        }
    </script>
</body>
</html>
